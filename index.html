<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- CSS STYLES --- */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: #0d1117; color: white; font-family: 'Roboto', sans-serif; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- LANDING PAGE STYLES (NEW) --- */
        #landing-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1f2937 0%, #0d1117 100%);
            z-index: 5000; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center;
        }
        .landing-logo { font-size: 50px; font-weight: 900; color: #e91e63; margin-bottom: 20px; font-style: italic; }
        .landing-box {
            background: #161b22; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px;
            border: 1px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .landing-btn {
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-web { background: transparent; border: 2px solid #30363d; color: white; }
        .btn-web:active { background: #30363d; }
        
        .btn-app { background: #e91e63; color: white; box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4); }
        .btn-app:active { transform: scale(0.98); }

        /* HIDE GAME INITIALLY */
        #game-container { display: none; height: 100%; width: 100%; }

        /* --- GAME CSS (SAME AS BEFORE) --- */
        .header { height: 60px; background: #161b22; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid #30363d; }
        .brand { font-size: 22px; font-weight: 900; color: #e91e63; font-style: italic; }
        .wallet-pill { background: #238636; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        .game-grid { display: flex; height: calc(100vh - 60px); width: 100%; }
        .sidebar { width: 220px; background: #0d1117; border-right: 1px solid #30363d; display: flex; flex-direction: column; }
        .stage { flex: 1; display: flex; flex-direction: column; position: relative; background: #010409; }
        .canvas-area { flex: 1; position: relative; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        .overlay-center { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; pointer-events: none; }
        .multiplier-big { font-size: 80px; font-weight: 900; }
        .controls-deck { height: 140px; background: #161b22; border-top: 1px solid #30363d; display: flex; justify-content: center; align-items: center; gap: 10px; padding: 10px; }
        .big-btn { width: 100px; height: 60px; border-radius: 6px; border: none; font-size: 16px; font-weight: bold; color: white; cursor: pointer; }
        .btn-green { background: #238636; } .btn-red { background: #da3633; }
        @media (max-width: 768px) { .sidebar { display: none; } }
    </style>
</head>
<body>

    <div id="landing-screen">
        <div class="landing-logo">üöÄ AVIATOR</div>
        <div class="landing-box">
            <p style="color:#aaa; margin-bottom:20px;">Choose how you want to play</p>
            
            <button class="landing-btn btn-app" id="install-btn" onclick="installApp()">
                üì± INSTALL APP
            </button>
            
            <button class="landing-btn btn-web" onclick="openWeb()">
                üåê CONTINUE ON WEB
            </button>
        </div>
        <p style="position: absolute; bottom: 20px; color: #555; font-size: 10px;">Secure Casino Environment v2.0</p>
    </div>

    <div id="game-container">
        
        <div class="header">
            <div class="brand">AVIATOR</div>
            <div class="wallet-pill">‚Çπ <span id="balance-el">1000.00</span></div>
        </div>

        <div class="game-grid">
            <div class="sidebar" style="padding:10px; color:#aaa; font-size:12px;">
                Live Bets...<br><br>
                User1: ‚Çπ500<br>User2: ‚Çπ1000<br>User3: ‚Çπ200
            </div>

            <div class="stage">
                <div class="canvas-area">
                    <canvas id="gameCanvas"></canvas>
                    <div class="overlay-center">
                        <div style="font-size: 20px; color: #aaa;" id="status-text">WAITING</div>
                        <div class="multiplier-big" id="multiplier-text">1.00x</div>
                    </div>
                </div>

                <div class="controls-deck">
                     <button class="big-btn btn-green" id="action-btn" onclick="handleAction()">BET ‚Çπ50</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. LANDING PAGE & PWA LOGIC ---
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        // PWA Setup
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }

        // Listen for Install Event
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex'; // Show Install Button
        });

        // Check if already in App Mode
        if (window.matchMedia('(display-mode: standalone)').matches) {
            openWeb(); // Skip landing page if already in app
        }

        function openWeb() {
            document.getElementById('landing-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            resize();
            gameLoop();
        }

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    deferredPrompt = null;
                }
            } else {
                alert("App installation is not supported on this browser/device yet. Please use Chrome/Safari.");
                openWeb();
            }
        }


        // --- 2. GAME LOGIC (Simplified for Demo) ---
        let multiplier = 1.00;
        let gameState = "IDLE";
        let balance = 1000;
        let betActive = false;
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let w, h;

        function resize() {
            w = canvas.parentElement.clientWidth;
            h = canvas.parentElement.clientHeight;
            canvas.width = w; canvas.height = h;
        }
        window.onresize = resize;

        function gameLoop() {
            gameState = "IDLE";
            multiplier = 1.00;
            document.getElementById('multiplier-text').innerText = "1.00x";
            document.getElementById('status-text').innerText = "STARTING...";
            document.getElementById('action-btn').innerText = "BET ‚Çπ50";
            document.getElementById('action-btn').className = "big-btn btn-green";
            document.getElementById('action-btn').disabled = false;
            
            draw();

            setTimeout(() => {
                fly();
            }, 3000);
        }

        function fly() {
            gameState = "FLYING";
            document.getElementById('status-text').innerText = "FLYING";
            if(betActive) {
                document.getElementById('action-btn').innerText = "CASH OUT";
                document.getElementById('action-btn').className = "big-btn btn-red"; // Use red/orange for cashout
            } else {
                document.getElementById('action-btn').innerText = "WAITING";
                document.getElementById('action-btn').disabled = true;
            }
            animate();
        }

        function animate() {
            if(gameState !== "FLYING") return;
            multiplier += 0.01;
            document.getElementById('multiplier-text').innerText = multiplier.toFixed(2) + "x";
            
            if(betActive) {
                 let win = (50 * multiplier).toFixed(0);
                 document.getElementById('action-btn').innerText = `CASH OUT ‚Çπ${win}`;
            }

            draw();

            // Random Crash Logic
            if(Math.random() > 0.99) {
                crash();
            } else {
                requestAnimationFrame(animate);
            }
        }

        function crash() {
            gameState = "CRASHED";
            document.getElementById('status-text').innerText = "FLEW AWAY";
            document.getElementById('multiplier-text').style.color = "red";
            betActive = false;
            setTimeout(() => {
                document.getElementById('multiplier-text').style.color = "white";
                gameLoop();
            }, 3000);
        }

        function handleAction() {
            if(gameState === "IDLE") {
                if(!betActive) {
                    betActive = true;
                    balance -= 50;
                    document.getElementById('action-btn').innerText = "BET PLACED";
                }
            } else if (gameState === "FLYING") {
                if(betActive) {
                    let win = 50 * multiplier;
                    balance += win;
                    betActive = false;
                    document.getElementById('action-btn').innerText = "WON!";
                    document.getElementById('action-btn').disabled = true;
                }
            }
            document.getElementById('balance-el').innerText = balance.toFixed(2);
        }

        function draw() {
            ctx.clearRect(0,0,w,h);
            ctx.fillStyle = "#e91e63";
            let x = (multiplier - 1) * 100;
            let y = h - ((multiplier - 1) * 100);
            if(x > w-50) x = w-50; if(y < 50) y = 50;
            ctx.beginPath(); ctx.arc(x, y, 10, 0, Math.PI*2); ctx.fill();
            
            // Grid
            ctx.strokeStyle = "#222";
            ctx.beginPath(); ctx.moveTo(0, h); ctx.lineTo(w, h); ctx.stroke();
        }

    </script>
</body>
</html>